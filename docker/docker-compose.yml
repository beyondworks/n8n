# n8n Docker Compose ì„¤ì •
# ì‚¬ìš©ë²•: docker-compose up -d

version: '3.8'

services:
  n8n:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: n8n
    restart: unless-stopped
    ports:
      - '5678:5678'
    environment:
      # ì‹œê°„ëŒ€ ì„¤ì • (í•œêµ­)
      - GENERIC_TIMEZONE=Asia/Seoul
      - TZ=Asia/Seoul

      # n8n ê¸°ë³¸ ì„¤ì •
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http

      # ================================
      # ğŸŒ í„°ë„ë§ ì„¤ì • (ì™¸ë¶€ ì ‘ì† í™œì„±í™”)
      # ================================
      # ê°œë°œ/í…ŒìŠ¤íŠ¸ìš© í„°ë„ (n8n ë‚´ì¥)
      - N8N_TUNNEL_MODE=${N8N_TUNNEL_MODE:-false}

      # Webhook URL ì„¤ì • (í„°ë„ ì‚¬ìš© ì‹œ ìë™ ì„¤ì •ë¨)
      # í”„ë¡œë•ì…˜ì—ì„œëŠ” ì‹¤ì œ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½
      # - WEBHOOK_URL=https://your-domain.com/

      # ================================
      # ë³´ì•ˆ ì„¤ì •
      # ================================
      - N8N_BASIC_AUTH_ACTIVE=${N8N_BASIC_AUTH_ACTIVE:-false}
      - N8N_BASIC_AUTH_USER=${N8N_BASIC_AUTH_USER:-}
      - N8N_BASIC_AUTH_PASSWORD=${N8N_BASIC_AUTH_PASSWORD:-}

      # ================================
      # ì›Œí¬í”Œë¡œìš° ì„¤ì •
      # ================================
      - EXECUTIONS_DATA_SAVE_ON_ERROR=all
      - EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
      - EXECUTIONS_DATA_SAVE_MANUAL_EXECUTIONS=true

      # ================================
      # API í‚¤ (.env íŒŒì¼ì—ì„œ ë¡œë“œ)
      # ================================
      - PERPLEXITY_API_KEY=${PERPLEXITY_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - NOTION_API_KEY=${NOTION_API_KEY:-}

    volumes:
      # ë°ì´í„° ì˜ì†í™” (ì›Œí¬í”Œë¡œìš°, ì¸ì¦ì •ë³´ ë“±)
      - n8n_data:/home/node/.n8n

      # ì›Œí¬í”Œë¡œìš° íŒŒì¼ ë§ˆìš´íŠ¸ (ì„ íƒì‚¬í•­)
      - ./workflows:/home/node/workflows:ro

    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:5678/healthz']
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  n8n_data:
    driver: local
